
<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.3.0/handlebars.min.js"></script>

{% raw %}
<script id="admin_flag_template" type="text/x-handlebars-template">
  <div id="div_{{flag_id}}" style="margin-top: 10px;">
    <p>Flag ID: {{flag_id}}</p>
  	<p>({{latitude}}, {{longitude}})</p>
    <p>{{owner}}</p>
  	<p>{{creation_date}}</p>
    <button id="{{flag_id}}" class="delete_item btn btn-danger">Approve Flag</button>
  </div>
</script>

{% endraw %}

<script type="text/javascript">
$(document).ready(function() {
	$.getJSON("/admin/api/flags",function(data){
		var template_source = $("#admin_flag_template").html();
		var template = Handlebars.compile(template_source);

		$.each(data.result, function(index,u){
			var context = {flag_id: u['flagID'], creation_date: u['creation_date'], id: u['_id'], owner: u['owner']};
			$("#flag_admin").append(template(context));
		});

		$(document).on("click","button.delete_item", function(){
			var item_id = event.target.id;

			// var clicked_object = JSON.parse(localStorage.getItem(event.target.id));
			// var map_centre = new google.maps.LatLng(clicked_object.latitude,clicked_object.longitude);
			localStorage.setItem("admin_flagApproval", item_id);

			// window.map.setCenter(map_centre);
      // // // // // // Why does this open both // // // // // 
			$("#flag_confirmModal").modal('show');
      $("#confirmModal").modal('hide');
			$("#flag_yes_im_sure").bind("click", function(){
				var delete_id = localStorage.getItem("admin_flagApproval"); //abusing localStorage for Fun and Profit. 

				$("#flag_confirmModal").modal('hide');
        $("#confirmModal").modal('hide');
				$.post("/admin/api/flag/approve",{this_id: delete_id, requested_by: "{{session['user_id']}}" }).done( function (data) {
  					console.log(data.message);
  					var div_item_id = "#div_" + delete_id;
  					$(div_item_id).remove(); //remove pinset from my tags
 				});
				

			});
		});


	});
});
</script>

<div class="modal fade" id="flag_confirmModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Are you sure?</h4>
      </div>
      <div class="modal-body">
        This flag will be approved.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="flag_yes_im_sure">Approve!</button>
      </div>
    </div>
  </div>
</div>