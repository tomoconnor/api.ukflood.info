
<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.3.0/handlebars.min.js"></script>

{% raw %}
<script id="admin_user_template" type="text/x-handlebars-template">
  <div id="div_{{id}}" style="margin-top: 10px;">
  	<p>{{screen_name}}</p>
  	<p>{{creation_date}}</p>
    <button id="{{id}}" class="delete_item btn btn-danger">Delete {{screen_name}}</button>
  </div>
</script>

{% endraw %}

<script type="text/javascript">
$(document).ready(function() {
	$.getJSON("/admin/api/users",function(data){
		var admin_user_template_source = $("#admin_user_template").html();
		var admin_user_template = Handlebars.compile(admin_user_template_source);

		$.each(data.result, function(index,u){
			var context = {screen_name: u['screen_name'], creation_date: u['creation_date'], id: u['_id']};
			$("#user_admin").append(admin_user_template(context));
		});

		$(document).on("click","button.delete_item", function(){
			var item_id = event.target.id;

			// var clicked_object = JSON.parse(localStorage.getItem(event.target.id));
			// var map_centre = new google.maps.LatLng(clicked_object.latitude,clicked_object.longitude);
			localStorage.setItem("admin_requestedForDeletion", item_id);

			// window.map.setCenter(map_centre);
			$("#confirmModal").modal('show');
			$("#yes_im_sure").bind("click", function(){
				var delete_id = localStorage.getItem("admin_requestedForDeletion"); //abusing localStorage for Fun and Profit. 

				$("#confirmModal").modal('hide');
				$.post("/admin/api/user/delete",{this_id: delete_id, requested_by: "{{session['user_id']}}" }).done( function (data) {
  					console.log(data.message);
  					var div_item_id = "#div_" + delete_id;
  					$(div_item_id).remove(); //remove pinset from my tags
 				});
				

			});
		});


	});
});
</script>

<div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Are you sure?</h4>
      </div>
      <div class="modal-body">
        This item will be deleted.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="yes_im_sure">Delete!</button>
      </div>
    </div>
  </div>
</div>